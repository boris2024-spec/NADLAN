# ะะฑะฝะพะฒะปะตะฝะธะต ะผะพะดะตะปะธ ะฐะดัะตัะฐ

## ๐ ะะทะผะตะฝะตะฝะธั ะฒ ะผะพะดะตะปะธ Property

### ะงัะพ ะธะทะผะตะฝะธะปะพัั

ะะพะปะต `location.address` ัะตะฟะตัั ะดะพะฟะพะปะฝะตะฝะพ ะดะฒัะผั ะฝะพะฒัะผะธ ะฟะพะปัะผะธ:
- `location.street` - ะะฐะทะฒะฐะฝะธะต ัะปะธัั (ะธะท API)
- `location.houseNumber` - ะะพะผะตั ะดะพะผะฐ

### ะกัััะบัััะฐ location (ะดะพ)
```javascript
location: {
    address: "ืจืืื ืืืืืืืฃ 123",
    city: "ืชื ืืืื - ืืคื",
    district: "ืฆืคืื ืืืฉื"
}
```

### ะกัััะบัััะฐ location (ะฟะพัะปะต)
```javascript
location: {
    address: "ืืืืืืืฃ 123",        // ะะพะปะฝัะน ะฐะดัะตั (ะณะตะฝะตัะธััะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ)
    street: "ืืืืืืืฃ",             // ะะฐะทะฒะฐะฝะธะต ัะปะธัั
    houseNumber: "123",             // ะะพะผะตั ะดะพะผะฐ
    city: "ืชื ืืืื - ืืคื",
    district: "ืฆืคืื ืืืฉื"
}
```

## ๐ง ะะฒัะพะผะฐัะธัะตัะบะฐั ัะธะฝััะพะฝะธะทะฐัะธั

ะะพะดะตะปั ัะตะฟะตัั ะธะผะตะตั middleware, ะบะพัะพััะน:

1. **ะัะธ ัะพััะฐะฝะตะฝะธะธ street + houseNumber**:
   ```javascript
   location.street = "ืืืืืืืฃ"
   location.houseNumber = "123"
   // ะะฒัะพะผะฐัะธัะตัะบะธ ัะพะทะดะฐัั:
   location.address = "ืืืืืืืฃ 123"
   ```

2. **ะัะธ ัะพััะฐะฝะตะฝะธะธ ัะพะปัะบะพ address**:
   ```javascript
   location.address = "ืืืืืืืฃ 123"
   // ะะฒัะพะผะฐัะธัะตัะบะธ ัะฐะทะดะตะปะธั ะฝะฐ:
   location.street = "ืืืืืืืฃ"
   location.houseNumber = "123"
   ```

## ๐ ะะธะณัะฐัะธั ัััะตััะฒัััะธั ะดะฐะฝะฝัั

### ะะฐะฟััะบ ะผะธะณัะฐัะธะธ

```bash
cd nadlan_back
node scripts/migrate-address-fields.mjs
```

### ะงัะพ ะดะตะปะฐะตั ัะบัะธะฟั

1. ะะพะดะบะปััะฐะตััั ะบ MongoDB
2. ะะฐัะพะดะธั ะฒัะต ะพะฑัะตะบัั ะฝะตะดะฒะธะถะธะผะพััะธ
3. ะะปั ะบะฐะถะดะพะณะพ ะพะฑัะตะบัะฐ:
   - ะัะปะธ ัะถะต ะตััั `street` - ะฟัะพะฟััะบะฐะตั
   - ะัะปะธ ะฝะตั `address` - ะฟัะพะฟััะบะฐะตั
   - ะะฐะทะดะตะปัะตั `address` ะฝะฐ `street` ะธ `houseNumber`
4. ะกะพััะฐะฝัะตั ะธะทะผะตะฝะตะฝะธั

### ะะพะณะธะบะฐ ัะฐะทะดะตะปะตะฝะธั

ะกะบัะธะฟั ะธัะฟะพะปัะทัะตั ะฟัะพัััั ัะฒัะธััะธะบั:
- ะะพัะปะตะดะฝะตะต ัะปะพะฒะพ, ะตัะปะธ ััะพ ัะธัะปะพ ะธะปะธ ัะธัะปะพ+ะฑัะบะฒะฐ (123, 5ื) โ ะฝะพะผะตั ะดะพะผะฐ
- ะััะฐะปัะฝะพะต โ ะฝะฐะทะฒะฐะฝะธะต ัะปะธัั

**ะัะธะผะตัั:**
```
"ืืืืืืืฃ 123" โ street: "ืืืืืืืฃ", houseNumber: "123"
"ืื ืืืืื 45ื" โ street: "ืื ืืืืื", houseNumber: "45ื"
"ืืืืืืืฃ" โ street: "ืืืืืืืฃ", houseNumber: ""
```

## ๐ ะะฑะฝะพะฒะปะตะฝะธะต ะธะฝะดะตะบัะพะฒ

ะะพะฑะฐะฒะปะตะฝ ะฝะพะฒัะน ะธะฝะดะตะบั ะดะปั ะฟะพะธัะบะฐ:
```javascript
propertySchema.index({
    'location.street': 'text'
});
```

## ๐ป ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะฒ API

### ะกะพะทะดะฐะฝะธะต/ะพะฑะฝะพะฒะปะตะฝะธะต ะพะฑัะตะบัะฐ

**ะะฐัะธะฐะฝั 1: ะัะฟัะฐะฒะธัั street ะธ houseNumber**
```json
{
  "location": {
    "street": "ืืืืืืืฃ",
    "houseNumber": "123",
    "city": "ืชื ืืืื - ืืคื"
  }
}
```

**ะะฐัะธะฐะฝั 2: ะัะฟัะฐะฒะธัั ัะพะปัะบะพ address**
```json
{
  "location": {
    "address": "ืืืืืืืฃ 123",
    "city": "ืชื ืืืื - ืืคื"
  }
}
```

**ะะฑะฐ ะฒะฐัะธะฐะฝัะฐ ะดะฐะดัั ะพะดะธะฝะฐะบะพะฒัะน ัะตะทัะปััะฐั!**

## โ๏ธ ะะฑัะฐัะฝะฐั ัะพะฒะผะตััะธะผะพััั

- ะกัะฐััะต ะดะฐะฝะฝัะต ั ัะพะปัะบะพ `address` ะฟัะพะดะพะปะถะฐั ัะฐะฑะพัะฐัั
- API ะฟัะธะฝะธะผะฐะตั ะพะฑะฐ ัะพัะผะฐัะฐ
- ะะพะธัะบ ัะฐะฑะพัะฐะตั ะฟะพ ะฒัะตะผ ะฟะพะปัะผ: `address`, `street`, `city`

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต

### ะัะพะฒะตัะบะฐ ะผะธะณัะฐัะธะธ

```javascript
// ะะพัะปะต ะผะธะณัะฐัะธะธ ะฟัะพะฒะตัััะต ะพะฑัะตะบั
const property = await Property.findOne({});
console.log(property.location);
// ะะพะปะถะฝั ัะฒะธะดะตัั: address, street, houseNumber, city
```

### ะัะพะฒะตัะบะฐ ะฐะฒัะพัะธะฝััะพะฝะธะทะฐัะธะธ

```javascript
// ะกะพะทะดะฐัั ะฝะพะฒัะน ะพะฑัะตะบั
const property = new Property({
  location: {
    street: "ืืืืื",
    houseNumber: "50",
    city: "ืชื ืืืื - ืืคื"
  }
});
await property.save();

console.log(property.location.address); 
// ะัะฒะตะดะตั: "ืืืืื 50"
```

## ๐ ะัะธะผะตัะฐะฝะธั

1. **ะะฑัะทะฐัะตะปัะฝัะต ะฟะพะปั**: `address` (ะธะปะธ `street`) ะธ `city`
2. **houseNumber** - ะพะฟัะธะพะฝะฐะปัะฝะพะต ะฟะพะปะต
3. Middleware ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะพะดะดะตัะถะธะฒะฐะตั ัะธะฝััะพะฝะธะทะฐัะธั
4. ะกัะฐััะน ะบะพะด ะฟัะพะดะพะปะถะธั ัะฐะฑะพัะฐัั ะฑะตะท ะธะทะผะตะฝะตะฝะธะน

## ๐ ะัะบะฐั ะผะธะณัะฐัะธะธ

ะัะปะธ ะฝัะถะฝะพ ะพัะบะฐัะธัั ะธะทะผะตะฝะตะฝะธั:

```javascript
// ะ ะบะพะฝัะพะปะธ MongoDB ะธะปะธ ัะตัะตะท ัะบัะธะฟั
db.properties.updateMany(
  {},
  { 
    $unset: { 
      "location.street": "", 
      "location.houseNumber": "" 
    }
  }
);
```
